<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Transmission â€“ Fragment visuel</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="container">
    <!-- Intro -->
    <div id="intro">
      <p id="introText">Connexion au canal 404Î”...<br><small>(Appuyez pour activer)</small></p>
      <div class="glitch-lines"></div>
      <audio id="introSound" src="assets/signal.mp3" preload="auto"></audio>
    </div>

    <!-- Transmission -->
    <div class="terminal">
      <h1 id="title">Fragment visuel reÃ§u</h1>
      
      <div class="player-container" id="mainContent">
        <p>Canal : <strong>404-Î”</strong></p>
        <img id="fragmentImage" src="assets/defb8defedT8.png" alt="Fragment visuel" style="max-width:100%; border-radius:12px; margin-top: 20px;">
      </div>

      <!-- Consignes (affichÃ©es automatiquement aprÃ¨s l'image) -->
      <div id="endMessage" class="hidden" aria-live="polite">
        <h3>Fragment dÃ©codÃ©</h3>
        <p>Information ajoutÃ©e Ã  votre base de donnÃ©es.</p>
      </div>
    </div>

    <div class="footer">Bureau de Sauvegarde Temporelle â€“ 2050</div>
  </div>

  <script>
// === Configuration ===
const PHONE = "33668666240"; // âš ï¸ TON VRAI NUMÃ‰RO ICI
const APIKEY = "8941906"; // âš ï¸ TON VRAI API KEY CALLMEBOT ICI
const WORKER_URL = "https://a303.stephane-btn.workers.dev";

// === Description du fragment ===
// âš ï¸ A CHANGER pour chaque page diffÃ©rente
const fragmentId = "fragment_8"; // Unique: fragment_image_1, fragment_image_2...
const fragmentName = "Fragment 8"; // Nom lisible pour WhatsApp

// === DÃ©tection de l'Ã©quipe ===
const params = new URLSearchParams(window.location.search);
const team = params.get("team") || "UNKNOWN";

const intro = document.getElementById('intro');
const introSound = document.getElementById('introSound');
const mainContent = document.getElementById('mainContent');
const title = document.getElementById('title');
const fragmentImage = document.getElementById('fragmentImage');
const endMessage = document.getElementById('endMessage');
let introPlayed = false;

// === Fonction d'envoi de notification ===
async function sendNotification() {
  const text = encodeURIComponent(`ğŸ¯ Ã‰quipe ${team} vient de dÃ©couvrir ${fragmentName}`);
  const url = `${WORKER_URL}?phone=${PHONE}&apikey=${APIKEY}&text=${text}&team=${team}&fragment=${fragmentId}`;
  
  console.log(`ğŸ“¤ Envoi notification: Team ${team} - ${fragmentName}`);
  
  try {
    const response = await fetch(url);
    if (response.ok) {
      console.log('âœ… Notification envoyÃ©e avec succÃ¨s');
    } else {
      console.error('âŒ Erreur envoi notification:', response.status);
    }
  } catch (error) {
    console.error('âŒ Erreur rÃ©seau:', error);
  }
}

intro.addEventListener("click", async () => {
  if (introPlayed) return;
  introPlayed = true;
  
  try {
    await introSound.play();
  } catch (err) {
    console.warn("Lecture intro bloquÃ©e :", err);
  }
  
  introSound.addEventListener("ended", () => {
    intro.style.opacity = 0;
    title.style.opacity = 1;
    
    setTimeout(() => {
      intro.style.display = "none";
      mainContent.style.opacity = 1;
      
      // ğŸ–¼ï¸ Pour un fragment image : envoi immÃ©diat aprÃ¨s affichage
      setTimeout(() => {
        console.log('ğŸ–¼ï¸ Fragment image affichÃ©');
        
        // Affiche le message de fin
        endMessage.classList.remove('hidden');
        requestAnimationFrame(() => {
          endMessage.classList.add('fade-in');
        });
        
        // ğŸ“¤ Envoie la notification immÃ©diatement
        sendNotification();
      }, 1500); // 1.5 secondes aprÃ¨s l'affichage de l'image
      
    }, 1500);
  });
});

// ğŸ”„ Alternative : Si vous prÃ©fÃ©rez envoyer la notification dÃ¨s que l'image est chargÃ©e
fragmentImage.addEventListener('load', () => {
  console.log('ğŸ–¼ï¸ Image chargÃ©e et prÃªte');
  // Vous pouvez dÃ©commenter la ligne ci-dessous pour envoyer dÃ¨s le chargement de l'image
  // sendNotification();
});

  </script>
</body>
</html>